<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.mat.inout.service.impl.MatInoutMapper">
	
	<!-- 자재입출고 입고리스트 -->
	<select id="selectMatInoutList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		              SELECT a.*,
		                     ROWNUM rnum
		              FROM   (
										SELECT  m.mat_inout_statement,
										        TO_CHAR(m.mat_inout_date, 'YYYY/MM/DD') as mat_inout_date,
										        q.erp_vendor_code,
										        d.com_code_detail_name,
										        m.com_material_code,
                           						c.com_material_name,
                           						c.com_material_size,
										        c.com_material_unit,
                           						m.mat_lot_no,
										        m.mat_inout_quantity,
										        m.mat_inout_unit_price,
										        m.mat_inout_price
                            
										FROM    mat_inout m,
										        qua_material_chk q,
										        com_material c,
										        com_code_detail d
                            
										WHERE   m.mat_inout_gubun = 'INOUT002'
					                    AND     m.com_material_code = c.com_material_code
					                    AND     m.com_material_code = q.com_material_code
					                    AND     q.erp_vendor_code = d.com_code_detail_id
					                    AND     q.qua_material_statement = m.qua_material_statement
		                              <if test="matInoutDate != null and matInoutDate != ''">
		                              	AND
							        	m.mat_inout_date BETWEEN #{matInoutDate} AND #{matInoutEndDate}
		                              </if>
		                              <if test="erpVendorCode != null and erpVendorCode != ''">
		                                AND
							        	q.erp_vendor_code LIKE '%' || #{erpVendorCode} || '%'
		                              </if>
		                              <if test="comMaterialCode != null and comMaterialCode != ''">
		                              	AND
							        	q.com_material_code LIKE '%' || #{comMaterialCode} || '%'
		                              </if>
									  
		                              ORDER BY mat_inout_date  <![CDATA[ ) a
		              WHERE  ROWNUM <= #{lastIndex} )
		WHERE  rnum >= #{firstIndex}
		]]>
	</select>
		<!-- 자재입출고 출고리스트  /////////////////////////다희씨 인서트 업데이트 완료되면 변경필요/////////////////////////////////-->
	<select id="selectMatInoutPassList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		              SELECT a.*,
		                     ROWNUM rnum
		              FROM   (
										SELECT    m.mat_inout_statement,
										          m.qua_material_statement,
										          TO_CHAR(m.mat_inout_date,'YY/MM/DD') as mat_inout_date,
										          m.com_material_code,
										          c.com_material_name,
										          c.com_material_size,
										          c.com_material_unit,
										          m.mat_lot_no,
										          m.mat_inout_quantity,
										          m.mat_inout_unit_price,
										          m.mat_inout_price,
										          m.com_process_code,
                              					  d.com_code_detail_name
										FROM      mat_inout m,
										          com_material c,
										          com_code_detail d,
                              					  qua_material_chk q
										WHERE     m.com_material_code = c.com_material_code
					                    AND       m.com_process_code = d.com_code_detail_id
					                    AND       m.qua_material_statement = q.qua_material_statement
					                    AND       m.mat_inout_gubun = 'INOUT003'
										AND       d.com_code_id = 'MES007'
		                              <if test="matInoutDate != null and matInoutDate != ''">
		                              	AND
							        	m.mat_inout_date BETWEEN #{matInoutDate} AND #{matInoutEndDate}
		                              </if>
		                              <if test="comMaterialCode != null and comMaterialCode != ''">
		                              	AND
							        	q.com_material_code LIKE '%' || #{comMaterialCode} || '%'
		                              </if>
									  
		                              ORDER BY mat_inout_date  <![CDATA[ ) a
		              WHERE  ROWNUM <= #{lastIndex} )
		WHERE  rnum >= #{firstIndex}
		]]>
	</select>
	<!-- 자재입출고 관리페이지 등록(일단 현재 필요없음) -->
<!-- 	<insert id="insertMatInout">
		INSERT INTO mat_inout (mat_inout_statement,
							   com_material_code,
							   com_process_code,
							   qua_material_statement,
							   mat_inout_gubun,
							   mat_inout_date,
							   mat_lot_no,
							   mat_inout_quantity,
							   mat_inout_unit_price,
							   mat_inout_price)
					VALUES  	(#{matInoutStatement},
								#{comMaterialCode},
						   		(select	DISTINCT(com_process_code)
							 	from	com_bom
							 	where	com_material_code = #{comMaterialCode}),
						   		#{quaMaterialStatement},
						   		#{matInoutGubun},
						   		#{matInoutDate},
						   		#{matLotNo},
						   		#{matInoutQuantity},
						   		#{matInoutUnitPrice},
						   		(#{matInoutQuantity}*#{matInoutUnitPrice}))

	</insert> -->
	
	<!-- 자재입출고 관리페이지 수정 -->
	<update id="updateMatInout">
		UPDATE mat_inout
		SET			mat_inout_quantity = #{matInoutQuantity},
		            mat_inout_price = #{matInoutPrice}
		       
		WHERE	qua_material_statement = #{quaMaterialStatement}
	</update>
	
	<!-- 자재입출고 관리 삭제 -->
	<delete id="deleteMatInout">
		DELETE FROM	mat_inout
		WHERE		qua_material_statement = #{quaMaterialStatement}
	</delete>
	

	
	<!-- 모달 자재검색 리스트  -->
	<select id="searchMaterialCodeList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		              SELECT a.*,
		                     ROWNUM rnum
		              FROM   (
		                              SELECT   com_material_code,
		                                       com_material_name,
		                                       com_material_size,
		                                       com_material_unit
		                              FROM     com_material
		                              WHERE	   1=1
					                  <if test="comMaterialCode != null and comMaterialCode !=''">AND
					                     com_material_code LIKE '%' || #{comMaterialCode} || '%'
					                  </if>
					                  <if test="comMaterialName != null and comMaterialName !=''">AND
					                     com_material_name LIKE '%' || #{comMaterialName} || '%'
					                  </if>
                  					  ORDER BY com_material_code <![CDATA[ ) A
					  WHERE ROWNUM <= #{lastIndex} )
		WHERE RNUM >= #{firstIndex}]]>
	</select>
	
	<!-- 모달 업체검색 리스트 -->
	<select id="searchVendorCodeList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		          	SELECT a.*,
		                     ROWNUM rnum
		            FROM   (
		                              SELECT   com_code_detail_id,
		                                       com_code_detail_name,
		                                       com_code_detail_desc
		                              FROM     com_code_detail
		                              WHERE    com_code_id = 'MES009'
					                  <if test="comCodeDetailId != null and comCodeDetailId !=''"> AND
					                     com_code_detail_id LIKE '%' || #{comCodeDetailId} || '%'
					                  </if>
					                  <if test="comCodeDetailName != null and comCodeDetailName !=''">AND
					                     com_code_detail_name LIKE '%' || #{comCodeDetailName} || '%'
					                  </if>
									  ORDER BY com_code_detail_id <![CDATA[ ) A
         			WHERE ROWNUM <= #{lastIndex})
		WHERE RNUM >= #{firstIndex}]]>
	</select>
	
		<!-- 모달 자재LOT_NO 리스트 -->
	<select id="searchMaterialLotList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		          	SELECT a.*,
		                     ROWNUM rnum
		            FROM   (
		                              SELECT   c.com_material_code,
		                                       c.com_material_name,
		                                       m.mat_lot_no,
		                                       m.mat_inout_quantity,
		                                       m.mat_inout_date
		                              FROM     mat_inout m,
		                              		   com_material c
		                              WHERE	   c.com_material_code = m.com_material_code
					                  <if test="matLotNo != null and matLotNo !=''"> AND
					                     mat_lot_no LIKE '%' || #{matLotNo} || '%'
					                  </if>
					                  <if test="comMaterialCode != null and comMaterialCode !=''">AND
					                     com_material_code LIKE '%' || #{comMaterialCode} || '%'
					                  </if>
									  ORDER BY mat_lot_no <![CDATA[ ) A
         			WHERE ROWNUM <= #{lastIndex})
		WHERE RNUM >= #{firstIndex}]]>
	</select>
</mapper>
