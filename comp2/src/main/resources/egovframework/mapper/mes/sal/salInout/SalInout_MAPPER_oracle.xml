<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.sal.inout.service.impl.SalInoutMapper">


	<resultMap id="salInout" type="mes.sal.inout.service.SalInoutVO">
		<result property="salInoutStatement" column="SAL_INOUT_STATEMENT" />
		<result property="comProductCode" column="COM_PRODUCT_CODE" />
		<result property="salInoutDate" column="SAL_INOUT_DATE" />
		<result property="salInoutQuantity" column="SAL_INOUT_QUANTITY" />
		<result property="salInoutCode" column="SAL_INOUT_CODE" />
		<result property="salInoutGubun" column="SAL_INOUT_GUBUN" />
		<result property="proProcessLotNo" column="PRO_PROCESS_LOT_NO" />
		<result property="proOrderDetailCode" column="PRO_ORDER_DETAIL_CODE" />
		<result property="salWriteDate" column="SAL_WRITE_DATE" />
		
		<result property="erpOrderCode" column="ERP_ORDER_CODE" />
		<result property="erpProductCode" column="ERP_PRODUCT_CODE" />
		<result property="erpOrderQty" column="ERP_ORDER_QTY" />
		<result property="erpCustomerCode" column="ERP_CUSTOMER_CODE" />
		<result property="erpProductUnitPrice" column="ERP_PRODUCT_UNIT_PRICE" />
		<result property="erpProductDeadline" column="ERP_PRODUCT_DEADLINE" />
		<result property="erpProductOrderDate" column="ERP_PRODUCT_ORDER_DATE" />
		<result property="erpProductName" column="ERP_PRODUCT_NAME" />
		<result property="erpCustomerName" column="ERP_CUSTOMER_NAME" />
		
		<result property="comCodeDetailId" column="COM_CODE_DETAIL_ID" />
		<result property="comCodeDetailName" column="COM_CODE_DETAIL_NAME" />
		<result property="comProductName" column="COM_PRODUCT_NAME" />
		<result property="proProcessQuantity" column="PRO_PROCESS_QUANTITY" />
	</resultMap>

	<!-- 한 건 조회 -->
	<select id="selectSalInout" resultMap="salInout">
		<![CDATA[
			SELECT SAL_INOUT_STATEMENT
				, COM_PRODUCT_CODE
				, SAL_INOUT_DATE
				, SAL_INOUT_QUANTITY
				, SAL_INOUT_CODE
				, SAL_INOUT_GUBUN
				, PRO_PROCESS_LOT_NO
			FROM SAL_INOUT
			WHERE SAL_INOUT_STATEMENT=#{salInoutStatement}
				]]>
	</select>

	<!-- 제품주문서 조회 -->
	<select id="selectSalInoutList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT
									ERP_ORDER_CODE, ERP_PRODUCT_CODE, ERP_PRODUCT_NAME,
									ERP_ORDER_QTY, ERP_PRODUCT_UNIT_PRICE,
					                GET_CODE_DETAIL(ERP_CUSTOMER_CODE) AS ERP_CUSTOMER_NAME,
									TO_CHAR(ERP_PRODUCT_DEADLINE, 'YYYY/MM/dd') AS ERP_PRODUCT_DEADLINE,
									TO_CHAR(ERP_PRODUCT_ORDER_DATE, 'YYYY/MM/dd') AS ERP_PRODUCT_ORDER_DATE	
									FROM ERP_PRODUCT_ORDER
				WHERE 1=1
			<if test="erpProductOrderDate != null and erpProductOrderDate != ''">AND
				ERP_PRODUCT_ORDER_DATE = #{erpProductOrderDate}
			</if>
			<if test="erpProductName != null and erpProductName != ''">AND
				ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
			</if>
			<if test="erpCustomerName != null and erpCustomerName != ''">AND
				GET_CODE_DETAIL(ERP_CUSTOMER_CODE) LIKE '%' || #{erpCustomerName} || '%'
			</if>
			ORDER BY ERP_PRODUCT_ORDER_DATE	DESC
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	
	<!-- 입출고목록 -->
	<!-- 입출고목록 한꺼번에 조회 -->
	<select id="selectSalProductInOutList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT
									SAL_INOUT_STATEMENT, I.COM_PRODUCT_CODE, P.PRO_PROCESS_LOT_NO,
									TO_CHAR(SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									I.SAL_INOUT_QUANTITY as SAL_INOUT_QUANTITY, SAL_INOUT_GUBUN,
									GET_CODE_DETAIL(COM_PRODUCT_CODE) AS COM_PRODUCT_NAME,
									SAL_INOUT_CODE, SAL_NOW_QUANTITY,
									TO_CHAR(SAL_WRITE_DATE, 'YYYY/MM/dd') as SAL_WRITE_DATE
									FROM SAL_INOUT I, PRO_PROCESS P
									WHERE SAL_INOUT_GUBUN NOT IN('INOUT001')
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="salInoutGubun != null and salInoutGubun != ''"> AND
					SAL_INOUT_GUBUN = #{salInoutGubun}
				</if>
				<if test="comProductCode != null and comProductCode != ''">AND
					I.COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					P.PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 입고목록 조회 -->
	<select id="selectSalProductInList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT
									SAL_INOUT_STATEMENT, COM_PRODUCT_CODE, PRO_PROCESS_LOT_NO,
									TO_CHAR(SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									SAL_INOUT_QUANTITY, SAL_INOUT_CODE, SAL_NOW_QUANTITY,
									GET_CODE_DETAIL(COM_PRODUCT_CODE) as COM_PRODUCT_NAME,
									TO_CHAR(SAL_WRITE_DATE, 'YYYY/MM/dd') as SAL_WRITE_DATE
									FROM SAL_INOUT
									WHERE SAL_INOUT_GUBUN = 'INOUT002'
				                	AND NOT PRO_PROCESS_LOT_NO IN
				                	(SELECT PRO_PROCESS_LOT_NO
				                	FROM SAL_INOUT
				                	WHERE SAL_INOUT_GUBUN = 'INOUT003')
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="comProductName != null and comProductName != ''">AND
					COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 출고목록 조회 -->
	<select id="selectSalProductOutList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (	
									SELECT
									TO_CHAR(I.SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									E.ERP_ORDER_CODE as PRO_ORDER_DETAIL_CODE,
				                  	E.ERP_PRODUCT_NAME as COM_PRODUCT_CODE,
				                  	E.ERP_ORDER_QTY as SAL_INOUT_QUANTITY,
									GET_CODE_DETAIL(E.ERP_CUSTOMER_CODE) as SAL_INOUT_CODE
									FROM ERP_PRODUCT_ORDER E, PRO_PLAN_DETAIL D,
									PRO_ORDER_DETAIL O, PRO_PROCESS P, SAL_INOUT I
									WHERE E.ERP_ORDER_CODE = D.ERP_ORDER_CODE
									AND D.PRO_PLAN_DETAIL_CODE = O.PRO_PLAN_DETAIL_CODE
									AND O.PRO_ORDER_DETAIL_CODE = P.PRO_ORDER_DETAIL_CODE
									AND P.PRO_PROCESS_LOT_NO IS NOT NULL
									AND I.SAL_INOUT_GUBUN = 'INOUT003'
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="comProductName != null and comProductName != ''">AND
					COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					I.PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 출고세부내역조회 -->
	<select id="selectSalOutDetail"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT PRO_PROCESS_LOT_NO, SAL_NOW_QUANTITY
		FROM SAL_INOUT
		WHERE SAL_INOUT_GUBUN = 'INOUT002'
		AND NOT SAL_NOW_QUANTITY IN ('0')
	</select>
	
	<!-- 입출고목록 삽입 -->
	<!-- 입고 -->
	<insert id="insertSalIn">
		INSERT INTO SAL_INOUT
		VALUES (#{salInoutStatement}
			, #{comProductCode}
			, #{salInoutDate}
			, #{salInoutQuantity}
			, #{salInoutCode}
			, 'INOUT002'
			, #{proProcessLotNo} <!-- LOT_NO는 세부 사항 업데이트 할 때 -->
			, SYSDATE
			, #{salNowQuantity}) <!-- 현 수량은 세부 사항 업데이트 할 때 -->
	</insert>
	<!-- 출고 -->
	<insert id="insertSalOut">			
		INSERT INTO SAL_INOUT
		VALUES (#{salInoutStatement}
			, #{comProductCode}
			, #{salInoutDate}
			, #{salInoutQuantity}
			, #{salInoutCode}
			, 'INOUT003'
			, #{proProcessLotNo}
			, SYSDATE
			, (#{salInoutQuantity} - #{salOutQuantity})) <!-- 현수량에  -->
	</insert>
	
	<!-- 입출고목록 수정 -->
	<!-- 입고 -->
	<update id="updateSalIn">
		UPDATE SAL_INOUT SET
		COM_PRODUCT_CODE = #{comProductCode}
		, SAL_INOUT_DATE = #{salInoutDate}
		, SAL_INOUT_QUANTITY = #{proOrderQty}
		, SAL_INOUT_CODE = #{salInoutCode}
		, PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		, SAL_WRITE_DATE = #{salWriteDate}
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}	
		AND SAL_INOUT_GUBUN = 'INOUT002'
	</update>
	
	<update id="updateSalOut">					
	<!-- 출고 -->
		UPDATE SAL_INOUT SET
		COM_PRODUCT_CODE = #{comProductCode}
		, SAL_INOUT_DATE = #{salInoutDate}
		, SAL_INOUT_QUANTITY = #{proProcessQuantity}
		, SAL_INOUT_CODE = #{salInoutCode}
		, SAL_INOUT_GUBUN = #{salInoutGubun}
		, PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		, SAL_WRITE_DATE = #{salWriteDate}
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
	</update>
	
	<!-- 입출고목록 삭제 -->
	<!-- 입고 -->
	<delete id="deleteSalIn">
		DELETE FROM SAL_INOUT
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
		AND PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		AND SAL_INOUT_GUBUN = 'INOUT002'
	</delete>
	
	<!-- 출고 -->
	<delete id="deleteSalOut">
		DELETE FROM SAL_INOUT
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
		AND SAL_INOUT_GUBUN = 'INOUT003'
		<if test="proProcessLotNo != null and proProcessLotNo != ''">
		AND PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		</if>
	</delete>
	
	<!-- 출고 세부 삭제? -->
	
	
	<!-- 반품목록 -->
	<!-- 반품입고목록 조회 -->
	<select id="selectSalReturnList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT
									I.SAL_INOUT_STATEMENT as SAL_INOUT_STATEMENT,
									TO_CHAR(S.SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									S.COM_PRODUCT_CODE as COM_PRODUCT_CODE,
									S.SAL_INOUT_CODE as SAL_INOUT_CODE,
									S.PRO_PROCESS_LOT_NO as PRO_PROCESS_LOT_NO,
									S.SAL_INOUT_QUANTITY as SAL_INOUT_QUANTITY,
									I.SAL_INOUT_QUANTITY as RETURN_QUANTITY,
									(S.SAL_INOUT_QUANTITY - I.SAL_INOUT_QUANTITY) as FINAL_QUANTITY,
									TO_CHAR(S.SAL_WRITE_DATE, 'YYYY/MM/dd') as SAL_WRITE_DATE
									FROM SAL_INOUT S, SAL_INOUT I
									WHERE 1=1
									AND S.PRO_PROCESS_LOT_NO = I.PRO_PROCESS_LOT_NO
									AND S.SAL_INOUT_GUBUN = 'INOUT003'
									AND I.SAL_INOUT_GUBUN = 'INOUT001'
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					I.SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					I.PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 반품입고목록 삽입 -->
	<insert id="insertSalReturn">
		INSERT INTO SAL_INOUT
		VALUES (#{salInoutStatement}
			, #{comProductCode}
			, #{salInoutDate}
			, #{returnQuantity}
			, #{salInoutCode}
			, 'INOUT001'
			, #{proProcessLotNo}
			, SYSDATE)
	</insert>
	
	<!-- 반품입고목록 수정 -->
	<update id="updateSalReturn">
		UPDATE SAL_INOUT SET
		COM_PRODUCT_CODE = #{comProductCode}
		, SAL_INOUT_DATE = #{salInoutDate}
		, SAL_INOUT_QUANTITY = #{returnQuantity}
		, SAL_INOUT_CODE = #{salInoutCode}
		, PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
		AND SAL_INOUT_GUBUN = 'INOUT001'
	</update>
	
	<!-- 반품입고목록 삭제 -->
	<delete id="deleteSalReturn">
		DELETE FROM SAL_INOUT
		WHERE PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		AND SAL_INOUT_GUBUN = 'INOUT001'
	</delete>	
	
	
	<!-- 페이지 -->
	<select id="selectSalInoutListTotCnt"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*) totcnt
		FROM SAL_INOUT
		WHERE 1=1
		<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == 0">AND
				SAL_INOUT_STATEMENT LIKE '%' || #{searchKeyword} || '%'
			</if>
			<if test="searchCondition == 1">AND
				COM_PRODUCT_CODE LIKE '%' || #{searchKeyword} || '%'
			</if>
		</if>
	</select>
	
	
	<!-- 모달  -->
	<!-- 모달 : 제품 목록 -->
	<select id="searchProductList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
						SELECT COM_PRODUCT_CODE,
								COM_PRODUCT_NAME,
								COM_PRODUCT_SIZE
						FROM COM_PRODUCT
						WHERE 1=1
						<if test="comProductCode != null and comProductCode!=''"> AND
							COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
						</if>
						<if test="comProductName != null and comProductName!=''">AND
							COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
						</if>
						ORDER BY 
								COM_PRODUCT_NAME DESC
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 제품 목록 총 갯수 -->
	<select id="searchProductListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM COM_PRODUCT
		<if test="(comProductCode != null and comProductCode != '')
					|| (comProductName !=null and comProductName != '')">
			<if test="searchCondition == 0">WHERE
				COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
			</if>
			<if test="searchCondition == 1">WHERE
				COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
			<if test="searchCondition == 2">WHERE
				COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
				AND COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 고객사 목록 -->
	<select id="searchCustomerList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
						SELECT COM_CODE_DETAIL_ID,
								COM_CODE_DETAIL_NAME
						FROM COM_CODE_DETAIL
						WHERE 1=1
						AND COM_CODE_DETAIL_ID LIKE '%CUSTOMER%'
						<if test="comCodeDetailId != null and comCodeDetailId != ''"> AND
							COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
						</if>
						<if test="comCodeDetailName != null and comCodeDetailName != ''">AND
							COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
						</if>
						ORDER BY 
								COM_CODE_DETAIL_ID
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 고객사 목록 총 갯수 -->
	<select id="searchCustomerListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM COM_CODE_DETAIL
		WHERE COM_CODE_DETAIL_ID LIKE '%CUSTOMER%' AND
		<if test="(comCodeDetailId != null and comCodeDetailId != '')
					|| (comCodeDetailName !=null and comCodeDetailName != '')">
			<if test="searchCondition == 0">
				COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
			</if>
			<if test="searchCondition == 1">
				COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
			</if>
			<if test="searchCondition == 2">
				COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
				AND COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 입고시킬 완제품 LOT_NO 목록 -->
	<select id="searchProductLotNoList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (	
											SELECT
						                    P.PRO_PROCESS_LOT_NO, D.ERP_PRODUCT_CODE,
						                    D.ERP_PRODUCT_NAME, D.PRO_ORDER_DETAIL_CODE,
						                    D.PRO_ORDER_QTY as PRO_ORDER_QTY
						                    FROM PRO_PROCESS P, PRO_ORDER_DETAIL D
						                    WHERE P.PRO_ORDER_DETAIL_CODE = D.PRO_ORDER_DETAIL_CODE
						                    AND P.PRO_PROCESS_LOT_NO IS NOT NULL
						                    AND NOT P.PRO_PROCESS_LOT_NO IN
						                    (SELECT PRO_PROCESS_LOT_NO
						                	FROM SAL_INOUT
						                	WHERE SAL_INOUT_GUBUN = 'INOUT002')
						<if test="proProcessLotNo != null and proProcessLotNo != ''"> AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						<if test="erpProductName != null and erpProductName != ''">AND
							ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
						</if>
						<if test="erpProductCode != null and erpProductCode != ''">AND
							ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
						</if>
						ORDER BY 
								P.PRO_PROCESS_LOT_NO
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 입고시킬 완제품 LOT_NO 목록 총 갯수 -->
	<select id="searchProductLotNoListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM PRO_PROCESS P, PRO_ORDER_DETAIL D
		WHERE  P.PRO_ORDER_DETAIL_CODE = D.PRO_ORDER_DETAIL_CODE
				AND P.COM_PROCESS_CODE = 'PROCG001'
		<if test="(proProcessLotNo != null and proProcessLotNo != '')
					|| (erpProductName !=null and erpProductName != '')
					|| (erpProductCode !=null and erpProductCode != '')">
			<if test="searchCondition == 0">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 1">
				ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
			</if>
			<if test="searchCondition == 2">
				ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			
			<if test="searchCondition == 3">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
			</if>
			<if test="searchCondition == 4">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			<if test="searchCondition == 5">
				ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			
			<if test="searchCondition == 6">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} '%'
			</if>
		</if>
	</select>
	
	<!-- 정산 후 출고용 완제품 LOT_NO 모달 -->
	<select id="searchModProductLotNoList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (	
							                SELECT DISTINCT
							                I.SAL_INOUT_QUANTITY as SAL_INOUT_QUANTITY,
							                I.SAL_INOUT_GUBUN, I.PRO_PROCESS_LOT_NO,
							                P.ERP_PRODUCT_CODE, P.ERP_PRODUCT_NAME,
							                P.ERP_CUSTOMER_CODE, I.SAL_NOW_QUANTITY
							                FROM SAL_INOUT I, SAL_INOUT O, PRO_ORDER_DETAIL P
							                WHERE I.SAL_INOUT_GUBUN = 'INOUT002'
							                AND O.SAL_INOUT_GUBUN NOT IN('INOUT003')
                              				AND I.SAL_INOUT_QUANTITY NOT IN('0')
							                AND I.PRO_PROCESS_LOT_NO = P.PRO_PROCESS_LOT_NO
						<if test="proProcessLotNo != null and proProcessLotNo != ''"> AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						<if test="erpProductName != null and erpProductName != ''">AND
							ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
						</if>
						<if test="erpProductCode != null and erpProductCode != ''">AND
							ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
						</if>
						ORDER BY 
								I.PRO_PROCESS_LOT_NO
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 정산 후 출고용 완제품 LOT_NO 모달 목록 총 갯수 -->
	<select id="searchModProductLotNoListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM SAL_INOUT I, SAL_INOUT O, PRO_ORDER_DETAIL P
		WHERE I.SAL_INOUT_GUBUN = 'INOUT002'
			AND O.SAL_INOUT_GUBUN NOT IN('INOUT003')
			AND I.PRO_PROCESS_LOT_NO = P.PRO_PROCESS_LOT_NO
		<if test="(proProcessLotNo != null and proProcessLotNo != '')
					|| (erpProductName !=null and erpProductName != '')
					|| (erpProductCode !=null and erpProductCode != '')">
			<if test="searchCondition == 0">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 1">
				ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
			</if>
			<if test="searchCondition == 2">
				ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			
			<if test="searchCondition == 3">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
			</if>
			<if test="searchCondition == 4">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			<if test="searchCondition == 5">
				ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			
			<if test="searchCondition == 6">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
				AND ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 제품주문서 목록 -->
	<select id="searchOrderList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
				SELECT A.*, ROWNUM RNUM FROM (
												SELECT
												ERP_ORDER_CODE, ERP_PRODUCT_CODE,
												ERP_ORDER_QTY, ERP_CUSTOMER_CODE,
												GET_CODE_DETAIL(ERP_PRODUCT_CODE) as ERP_PRODUCT_NAME,
												GET_CODE_DETAIL(ERP_CUSTOMER_CODE) as ERP_CUSTOMER_NAME,
												TO_CHAR(ERP_PRODUCT_DEADLINE, 'YYYY/MM/dd') AS ERP_PRODUCT_DEADLINE
												FROM ERP_PRODUCT_ORDER		                 					
							<if test="erpCustomerName != null and erpCustomerName != ''"> AND
								ERP_CUSTOMER_NAME LIKE '%' || #{erpCustomerName} || '%'
							</if>
							<if test="erpProductName != null and erpProductName != ''">AND
								ERP_PRODUCT_NAME LIKE '%' || #{erpProductName} || '%'
							</if>
							ORDER BY ERP_ORDER_CODE
					<![CDATA[					
				) A WHERE ROWNUM <= #{lastIndex}
			)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 생산지시디테일코드 목록 -->
	<select id="searchProductCodeList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
											SELECT
											PRO_ORDER_DETAIL_CODE, ERP_PRODUCT_DEADLINE, ERP_CUSTOMER_CODE,
											ERP_PRODUCT_CODE, PRO_PROCESS_LOT_NO
											FROM PRO_ORDER_DETAIL
											WHERE 1=1
						<if test="proOrderDetailCode != null and proOrderDetailCode != ''"> AND
							PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
						</if>
						<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						ORDER BY 
								PRO_ORDER_DETAIL_CODE
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 생산지시디테일코드 목록 총 갯수 -->
	<select id="searchProductCodeListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM PRO_ORDER_DETAIL
		<if test="(proOrderDetailCode != null and proOrderDetailCode != '')
				|| (proProcessLotNo !=null and proProcessLotNo != '')">
			<if test="searchCondition == 0">
				PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
			</if>
			<if test="searchCondition == 1">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 2">
				PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
				AND PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
		</if>
	</select>
	
	
	<!-- 사용 x -->
	<!-- 모달 : 전표번호(반품) 목록 -->
	<select id="searchInoutStatementList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
											SELECT SAL_INOUT_STATEMENT, SAL_INOUT_CODE, 
											COM_PRODUCT_CODE, PRO_PROCESS_LOT_NO
											FROM SAL_INOUT
											WHERE 1=1
											AND SAL_INOUT_GUBUN = 'INOUT001'
						<if test="salInoutStatement != null and salInoutStatement != ''"> AND
							SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
						</if>
						<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						ORDER BY 
								SAL_INOUT_STATEMENT
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 전표번호(반품) 목록 총 갯수 -->
	<select id="searchInoutStatementListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM SAL_INOUT
		<if test="(salInoutStatement != null and salInoutStatement != '')
				|| (proProcessLotNo != null and proProcessLotNo != '')">
			<if test="searchCondition == 0">
				SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
			</if>
			<if test="searchCondition == 1">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 2">
				SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
				AND PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
		</if>
	</select>

</mapper>
