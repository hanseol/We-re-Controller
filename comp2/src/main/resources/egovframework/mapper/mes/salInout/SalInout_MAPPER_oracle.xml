<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.sal.inout.service.impl.SalInoutMapper">


	<resultMap id="salInout" type="mes.sal.inout.service.SalInoutVO">
		<result property="salInoutStatement" column="SAL_INOUT_STATEMENT" />
		<result property="comProductCode" column="COM_PRODUCT_CODE" />
		<result property="salInoutDate" column="SAL_INOUT_DATE" />
		<result property="salInoutQuantity" column="SAL_INOUT_QUANTITY" />
		<result property="salInoutCode" column="SAL_INOUT_CODE" />
		<result property="salInoutGubun" column="SAL_INOUT_GUBUN" />
		<result property="proProcessLotNo" column="PRO_PROCESS_LOT_NO" />
		<result property="proOrderDetailCode" column="PRO_ORDER_DETAIL_CODE" />
		<result property="salWriteDate" column="SAL_WRITE_DATE" />
		
		<result property="erpOrderCode" column="ERP_ORDER_CODE" />
		<result property="erpProductCode" column="ERP_PRODUCT_CODE" />
		<result property="erpOrderQty" column="ERP_ORDER_QTY" />
		<result property="erpCustomerCode" column="ERP_CUSTOMER_CODE" />
		<result property="erpProductUnitPrice" column="ERP_PRODUCT_UNIT_PRICE" />
		<result property="erpProductDeadline" column="ERP_PRODUCT_DEADLINE" />
		<result property="erpProductOrderDate" column="ERP_PRODUCT_ORDER_DATE" />
		<result property="erpProductName" column="ERP_PRODUCT_NAME" />
		
		<result property="comCodeDetailId" column="COM_CODE_DETAIL_ID" />
		<result property="comCodeDetailName" column="COM_CODE_DETAIL_NAME" />
		<result property="comProductName" column="COM_PRODUCT_NAME" />
	</resultMap>

	<!-- 한 건 조회 -->
	<select id="selectSalInout" resultMap="salInout">
		<![CDATA[
			SELECT SAL_INOUT_STATEMENT
				, COM_PRODUCT_CODE
				, SAL_INOUT_DATE
				, SAL_INOUT_QUANTITY
				, SAL_INOUT_CODE
				, SAL_INOUT_GUBUN
				, PRO_PROCESS_LOT_NO
			FROM SAL_INOUT
			WHERE SAL_INOUT_STATEMENT=#{salInoutStatement}
				]]>
	</select>

	<!-- 주문관리참조 조회 -->
	<select id="selectSalInoutList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT ERP_ORDER_CODE, ERP_PRODUCT_CODE,
									ERP_ORDER_QTY, ERP_CUSTOMER_CODE, ERP_PRODUCT_UNIT_PRICE,
									TO_CHAR(ERP_PRODUCT_DEADLINE, 'YYYY/MM/dd') AS ERP_PRODUCT_DEADLINE,
									TO_CHAR(ERP_PRODUCT_ORDER_DATE, 'YYYY/MM/dd') AS ERP_PRODUCT_ORDER_DATE,
									ERP_PRODUCT_NAME
									FROM ERP_PRODUCT_ORDER
				WHERE 1=1
			<if test="erpProductOrderDate != null and erpProductOrderDate != ''">AND
				ERP_PRODUCT_ORDER_DATE = #{erpProductOrderDate}
			</if>
			<if test="erpProductCode != null and erpProductCode != ''">AND
				ERP_PRODUCT_CODE LIKE '%' || #{erpProductCode} || '%'
			</if>
			<if test="erpCustomerCode != null and erpCustomerCode != ''">AND
				ERP_CUSTOMER_CODE LIKE '%' || #{erpCustomerCode} || '%'
			</if>
		ORDER BY ERP_PRODUCT_ORDER_DATE	DESC
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 입출고목록 조회 -->
	<select id="selectSalProductInoutList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT SAL_INOUT_STATEMENT, I.COM_PRODUCT_CODE,
									TO_CHAR(SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									SAL_INOUT_QUANTITY, SAL_INOUT_GUBUN, P.PRO_PROCESS_LOT_NO,
									C.COM_PRODUCT_NAME, SAL_INOUT_CODE,
									TO_CHAR(SAL_WRITE_DATE, 'YYYY/MM/dd') as SAL_WRITE_DATE
									FROM SAL_INOUT I, PRO_PROCESS P, COM_PRODUCT C
									WHERE SAL_INOUT_GUBUN NOT IN('INOUT001')
									AND P.PRO_PROCESS_LOT_NO = I.PRO_PROCESS_LOT_NO
									AND C.COM_PRODUCT_NAME = P.ERP_PRODUCT_NAME
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="salInoutGubun != null and salInoutGubun != ''"> AND
					SAL_INOUT_GUBUN = #{salInoutGubun}
				</if>
				<if test="comProductCode != null and comProductCode != ''">AND
					I.COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					P.PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 입출고목록 삽입 -->
	<insert id="insertSalInout">
		INSERT INTO SAL_INOUT
		VALUES (#{salInoutStatement}
			, #{comProductCode}
			, #{salInoutDate}
			, #{salInoutQuantity}
			, #{salInoutCode}
			, #{salInoutGubun}
			, #{proProcessLotNo}
			, SYSDATE)
	</insert>
	
	<!-- 입출고목록 수정 -->
	<update id="updateSalInout">
		UPDATE SAL_INOUT SET
		COM_PRODUCT_CODE = #{comProductCode}
		, SAL_INOUT_DATE = #{salInoutDate}
		, SAL_INOUT_QUANTITY = #{salInoutQuantity}
		, SAL_INOUT_CODE = #{salInoutCode}
		, SAL_INOUT_GUBUN = #{salInoutGubun}
		, PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		, SAL_WRITE_DATE = #{salWriteDate}
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
	</update>
	
	<!-- 입출고목록 삭제 -->
	<delete id="deleteSalInout">
		DELETE FROM SAL_INOUT
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
	</delete>
	
	<!-- 반품입고목록 조회 -->
	<select id="selectSalReturnList"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT *
		FROM (
				SELECT A.*,
				ROWNUM RNUM FROM (
									SELECT
									TO_CHAR(SAL_INOUT_DATE, 'YYYY/MM/dd') as SAL_INOUT_DATE,
									SAL_INOUT_STATEMENT, SAL_INOUT_CODE, 
									COM_PRODUCT_CODE, SAL_INOUT_QUANTITY,
									TO_CHAR(SAL_WRITE_DATE, 'YYYY/MM/dd') as SAL_WRITE_DATE,
									PRO_PROCESS_LOT_NO
									FROM SAL_INOUT
									WHERE 1=1
									AND SAL_INOUT_GUBUN = 'INOUT001'
				<if test="salInoutDate != null and salInoutDate != ''"> AND
					SAL_INOUT_DATE = #{salInoutDate}
				</if>
				<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
					PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				</if>
		ORDER BY SAL_INOUT_DATE DESC		
			<![CDATA[						
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 반품입고목록 삽입 -->
	<insert id="insertSalReturn">
		INSERT INTO SAL_INOUT
		VALUES (#{salInoutStatement}
			, #{comProductCode}
			, #{salInoutDate}
			, #{salInoutQuantity}
			, #{salInoutCode}
			, 'INOUT001'
			, #{proProcessLotNo}
			, SYSDATE)
	</insert>
	
	<!-- 반품입고목록 수정 -->
	<update id="updateSalReturn">
		UPDATE SAL_INOUT SET
		COM_PRODUCT_CODE = #{comProductCode}
		, SAL_INOUT_DATE = #{salInoutDate}
		, SAL_INOUT_QUANTITY = #{salInoutQuantity}
		, SAL_INOUT_CODE = #{salInoutCode}
		, PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		WHERE SAL_INOUT_STATEMENT = #{salInoutStatement}
		AND SAL_INOUT_GUBUN = 'INOUT001'
	</update>
	
	<!-- 반품입고목록 삭제 -->
	<delete id="deleteSalReturn">
		DELETE FROM SAL_INOUT
		WHERE PRO_PROCESS_LOT_NO = #{proProcessLotNo}
		AND SAL_INOUT_GUBUN = 'INOUT001'
	</delete>	
	
	<!-- 페이지 -->
	<select id="selectSalInoutListTotCnt"
		parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*) totcnt
		FROM SAL_INOUT
		WHERE 1=1
		<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == 0">AND
				SAL_INOUT_STATEMENT LIKE '%' || #{searchKeyword} || '%'
			</if>
			<if test="searchCondition == 1">AND
				COM_PRODUCT_CODE LIKE '%' || #{searchKeyword} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달  -->
	<!-- 모달 : 제품 목록 -->
	<select id="searchProductList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
						SELECT COM_PRODUCT_CODE,
								COM_PRODUCT_NAME,
								COM_PRODUCT_SIZE
						FROM COM_PRODUCT
						WHERE 1=1
						<if test="comProductCode != null and comProductCode!=''"> AND
							COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
						</if>
						<if test="comProductName != null and comProductName!=''">AND
							COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
						</if>
						ORDER BY 
								COM_PRODUCT_NAME
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 제품 목록 총 갯수 -->
	<select id="searchProductListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM COM_PRODUCT
		<if test="(comProductCode != null and comProductCode != '')
					|| (comProductName !=null and comProductName != '')">
			<if test="searchCondition == 0">WHERE
				COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
			</if>
			<if test="searchCondition == 1">WHERE
				COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
			<if test="searchCondition == 2">WHERE
				COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
				AND COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 고객사 목록 -->
	<select id="searchCustomerList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
						SELECT COM_CODE_DETAIL_ID,
								COM_CODE_DETAIL_NAME,
								COM_CODE_DETAIL_DESC
						FROM COM_CODE_DETAIL
						WHERE 1=1
						AND COM_CODE_DETAIL_ID LIKE '%CUSTOMER%'
						<if test="comCodeDetailId != null and comCodeDetailId != ''"> AND
							COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
						</if>
						<if test="comCodeDetailName != null and comCodeDetailName != ''">AND
							COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
						</if>
						ORDER BY 
								COM_CODE_DETAIL_ID
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 고객사 목록 총 갯수 -->
	<select id="searchCustomerListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM COM_CODE_DETAIL
		WHERE COM_CODE_DETAIL_ID LIKE '%CUSTOMER%' AND
		<if test="(comCodeDetailId != null and comCodeDetailId != '')
					|| (comCodeDetailName !=null and comCodeDetailName != '')">
			<if test="searchCondition == 0">
				COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
			</if>
			<if test="searchCondition == 1">
				COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
			</if>
			<if test="searchCondition == 2">
				COM_CODE_DETAIL_ID LIKE '%' || #{comCodeDetailId} || '%'
				AND COM_CODE_DETAIL_NAME LIKE '%' || #{comCodeDetailName} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 완제품 LOT_NO 목록 -->
	<select id="searchProductLotNoList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
						SELECT P.PRO_PROCESS_LOT_NO, C.COM_PRODUCT_NAME, C.COM_PRODUCT_CODE
						FROM PRO_PROCESS P, COM_PRODUCT C
						WHERE 1=1
						AND P.ERP_PRODUCT_NAME = C.COM_PRODUCT_NAME
						AND P.PRO_PROCESS_LOT_NO IS NOT NULL
						<if test="proProcessLotNo != null and proProcessLotNo != ''"> AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						<if test="comProductName != null and comProductName != ''">AND
							COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
						</if>
						<if test="comProductCode != null and comProductCode != ''">AND
							COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
						</if>
						ORDER BY 
								P.PRO_PROCESS_LOT_NO
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 완제품 LOT_NO 목록 총 갯수 -->
	<select id="searchProductLotNoListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM PRO_PROCESS P, COM_PRODUCT C
		WHERE P.ERP_PRODUCT_NAME = C.COM_PRODUCT_NAME
		AND P.PRO_PROCESS_LOT_NO IS NOT NULL
		<if test="(proProcessLotNo != null and proProcessLotNo != '')
					|| (comProductName !=null and comProductName != '')
					|| (comProductCode !=null and comProductCode != '')">
			<if test="searchCondition == 0">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 1">
				COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
			<if test="searchCondition == 2">
				COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
			</if>
			
			<if test="searchCondition == 3">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
			</if>
			<if test="searchCondition == 4">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
			</if>
			<if test="searchCondition == 5">
				COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
				AND COM_PRODUCT_CODE LIKE '%' || #{comProductCode} || '%'
			</if>
			
			<if test="searchCondition == 6">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
				AND COM_PRODUCT_NAME LIKE '%' || #{comProductName} || '%'
				AND COM_PRODUCT_CODE LIKE '%' || #{comProductCode} '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 생산지시디테일코드 목록 -->
	<select id="searchProductCodeList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
											SELECT PRO_ORDER_DETAIL_CODE, ERP_PRODUCT_DEADLINE, ERP_CUSTOMER_CODE,
											ERP_PRODUCT_CODE, PRO_PROCESS_LOT_NO
											FROM PRO_ORDER_DETAIL
											WHERE 1=1
						<if test="proOrderDetailCode != null and proOrderDetailCode != ''"> AND
							PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
						</if>
						<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						ORDER BY 
								PRO_ORDER_DETAIL_CODE
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 생산지시디테일코드 목록 총 갯수 -->
	<select id="searchProductCodeListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM PRO_ORDER_DETAIL
		<if test="(proOrderDetailCode != null and proOrderDetailCode != '')
				|| (proProcessLotNo !=null and proProcessLotNo != '')">
			<if test="searchCondition == 0">
				PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
			</if>
			<if test="searchCondition == 1">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 2">
				PRO_ORDER_DETAIL_CODE LIKE '%' || #{proOrderDetailCode} || '%'
				AND PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
		</if>
	</select>
	
	<!-- 모달 : 전표번호(반품) 목록 -->
	<select id="searchInoutStatementList" parameterType="mes.sal.inout.service.SalInoutVO" resultType="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
											SELECT SAL_INOUT_STATEMENT, SAL_INOUT_CODE, 
											COM_PRODUCT_CODE, PRO_PROCESS_LOT_NO
											FROM SAL_INOUT
											WHERE 1=1
											AND SAL_INOUT_GUBUN = 'INOUT001'
						<if test="salInoutStatement != null and salInoutStatement != ''"> AND
							SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
						</if>
						<if test="proProcessLotNo != null and proProcessLotNo != ''">AND
							PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
						</if>
						ORDER BY 
								SAL_INOUT_STATEMENT
				<![CDATA[					
			) A WHERE ROWNUM <= #{lastIndex}
		)WHERE RNUM >= #{firstIndex}
		]]>
	</select>
	
	<!-- 모달 : 전표번호(반품) 목록 총 갯수 -->
	<select id="searchInoutStatementListTotCnt" parameterType="mes.sal.inout.service.SalInoutVO" resultType="int">
		SELECT COUNT(*)
		FROM SAL_INOUT
		<if test="(salInoutStatement != null and salInoutStatement != '')
				|| (proProcessLotNo != null and proProcessLotNo != '')">
			<if test="searchCondition == 0">
				SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
			</if>
			<if test="searchCondition == 1">
				PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
			<if test="searchCondition == 2">
				SAL_INOUT_STATEMENT LIKE '%' || #{salInoutStatement} || '%'
				AND PRO_PROCESS_LOT_NO LIKE '%' || #{proProcessLotNo} || '%'
			</if>
		</if>
	</select>

</mapper>
