<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.mat.matr.service.impl.ComMaterialMapper">
	

	<resultMap id="matInout" type="mes.mat.inout.service.MatInoutVO">
		<result property="matInoutStatement" column="MAT_INOUT_STATEMENT" />
		<result property="comMaterialCode" column="COM_MATERIAL_CODE" />
		<result property="matInoutDate" column="MAT_INOUT_DATE" />
		<result property="matInoutGubun" column="MAT_INOUT_GUBUN" />
		<result property="matInoutQuantity" column="MAT_INOUT_QUANTITY" />
		<result property="matLotNo" column="MAT_LOT_NO" />
		<result property="comProcessCode" column="COM_PROCESS_CODE" />
		<result property="matInoutUnitPrice" column="MAT_INOUT_UNIT_PRICE" />
		<result property="matInoutPrice" column="MAT_INOUT_PRICE" />
	</resultMap>
	<resultMap id="comMaterial"
		type="mes.mat.matr.service.ComMaterialVO">
		<result property="comMaterialCode" column="COM_MATERIAL_CODE" />
		<result property="comMaterialName" column="COM_MATERIAL_NAME" />
		<result property="comMaterialBarcode" column="COM_MATERIAL_BARCODE" />
		<result property="comMaterialSize" column="COM_MATERIAL_SIZE" />
		<result property="comMaterialUnit" column="COM_MATERIAL_UNIT" />
		<result property="comMaterialVendorCode" column="COM_MATERIAL_VENDOR_CODE" />
		<result property="comMaterialSafetyStock" column="COM_MATERIAL_SAFETY_STOCK" />
		<result property="comMaterialMin" column="COM_MATERIAL_MIN" />
		<result property="comMaterialMax" column="COM_MATERIAL_MAX" />
	</resultMap>
	<resultMap type="mes.main.map.ResultMapVO" id="resultMaps">
		<collection property="matInoutVO" resultMap="matInout" />
		<collection property="matrVO" resultMap="comMaterial" />
	</resultMap>
	
	<insert id="insertComMaterial">
		<![CDATA[
			INSERT INTO COM_MATERIAL 
				( COM_MATERIAL_CODE
				  , COM_MATERIAL_NAME
				  , COM_MATERIAL_BARCODE
				  , COM_MATERIAL_SIZE
				  , COM_MATERIAL_UNIT
				  , COM_MATERIAL_VENDOR_CODE
				  , COM_MATERIAL_SAFETY_STOCK
				  , COM_MATERIAL_MIN
				  , COM_MATERIAL_MAX )
			VALUES ( #{comMaterialCode}
				  , #{comMaterialName}
				  , #{comMaterialBarcode}
				  , #{comMaterialSize}
				  , #{comMaterialUnit}
				  , #{comMaterialVendorCode}
				  , #{comMaterialSafetyStock}
				  , #{comMaterialMin}
				  , #{comMaterialMax} )
		]]>
	</insert>
	
	<update id="updateComMaterial">
		<![CDATA[
			UPDATE COM_MATERIAL
			SET COM_MATERIAL_CODE=#{comMaterialCode}
				, COM_MATERIAL_NAME=#{comMaterialName}
				, COM_MATERIAL_BARCODE=#{comMaterialBarcode}
				, COM_MATERIAL_SIZE=#{comMaterialSize}
				, COM_MATERIAL_UNIT=#{comMaterialUnit}
				, COM_MATERIAL_VENDOR_CODE=#{comMaterialVendorCode}
				, COM_MATERIAL_SAFETY_STOCK=#{comMaterialSafetyStock}
				, COM_MATERIAL_MIN=#{comMaterialMin}
				, COM_MATERIAL_MAX=#{comMaterialMax}
						WHERE COM_MATERIAL_CODE=#{comMaterialCode}
				]]>
	</update>
	
	<delete id="deleteComMaterial">
		<![CDATA[
			DELETE FROM COM_MATERIAL 
						WHERE COM_MATERIAL_CODE=#{comMaterialCode}
				]]>
	</delete>
	
	<select id="selectComMaterial" resultMap="comMaterial">
		<![CDATA[
			SELECT
				COM_MATERIAL_CODE
				, COM_MATERIAL_NAME
				, COM_MATERIAL_BARCODE
				, COM_MATERIAL_SIZE
				, COM_MATERIAL_UNIT
				, COM_MATERIAL_VENDOR_CODE
				, COM_MATERIAL_SAFETY_STOCK
				, COM_MATERIAL_MIN
				, COM_MATERIAL_MAX
			FROM COM_MATERIAL
						WHERE COM_MATERIAL_CODE=#{comMaterialCode}
				]]>
	</select>
	
	<select id="selectComMaterialList" parameterType="mes.mat.matr.service.ComMaterialVO" resultType="egovMap">
SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT
								COM_MATERIAL_CODE
								, COM_MATERIAL_NAME
								, COM_MATERIAL_BARCODE
								, COM_MATERIAL_SIZE
								, COM_MATERIAL_UNIT
								, COM_MATERIAL_VENDOR_CODE
								, COM_MATERIAL_SAFETY_STOCK
								, COM_MATERIAL_MIN
								, COM_MATERIAL_MAX
						FROM COM_MATERIAL
				WHERE 1=1
				<if test="searchKeyword != null and searchKeyword != ''">
					<if test="searchCondition == 0">AND
						COM_MATERIAL_CODE = #{searchKeyword}
					</if>
					<if test="searchCondition == 1">AND
						COM_MATERIAL_NAME LIKE '%' || #{searchKeyword} || '%'
					</if>
				</if>
					ORDER BY 
						COM_MATERIAL_CODE DESC
		
		<![CDATA[					
	) A WHERE ROWNUM <= #{lastIndex}
)WHERE RNUM > #{firstIndex}
]]>
	</select>	
	<select id="selectComMaterialListTotCnt" parameterType="mes.mat.matr.service.ComMaterialVO" resultType="int">
			SELECT COUNT(*) totcnt
			FROM COM_MATERIAL
			WHERE 1=1
			<if test="searchKeyword != null and searchKeyword != ''">
				<if test="searchCondition == 0">AND
					COM_MATERIAL_CODE = #{searchKeyword}
				</if>
				<if test="searchCondition == 1">AND
					COM_MATERIAL_NAME LIKE '%' || #{searchKeyword} || '%'
				</if>
			</if>
	</select>
	
	<!-- 자재재고조회페이지 전체 리스트 출력 -->
	<select id="selectMatList" resultMap="resultMaps">
		SELECT  c.com_material_code,
        		c.com_material_name,
        		c.com_material_safety_stock,
        <!--이월량 계산-->
        		m.mat_inout_quantity,
        		m.mat_inout_quantity
        <!--현재고 계산-->
        <!--미달량 계산-->
		FROM    com_material c,
        		mat_inout m
		WHERE   c.com_material_code = m.com_material_code
	</select>
</mapper>
