<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.mat.inout.service.impl.MatInoutMapper">
	
	<!-- 자재입출고조회페이지 전체조회 -->
	<select id="selectMatInoutList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		              SELECT a.*,
		                     ROWNUM rnum
		              FROM   (
		                              SELECT   TO_CHAR(m.mat_inout_date, 'YYYY/MM/DD') mat_inout_date,
		                              		   c.com_material_code,
		                                       c.com_material_name,
		                                       c.com_material_size,
		                                       c.com_material_unit,
		                                       e.erp_material_order_code,
		                                       m.mat_inout_quantity,
		                                       m.mat_inout_unit_price,
		                                       m.mat_inout_price,
		                                       m.mat_lot_no,
		                                       (q.qua_material_p_qty - CASE m.mat_inout_gubun
                                                                    	WHEN 'PNS003'
                                                                    	THEN mat_inout_quantity
                                                                    	ELSE 0
                                                                    	END						) as material_stock
		                                       
		                              FROM     erp_material_order e,
		                                       com_material c,
		                                       mat_inout m,
		                                       qua_material_chk q
		                              WHERE    e.com_material_code = c.com_material_code
		                              AND      c.com_material_code = m.com_material_code
		                              AND	   q.com_material_code = m.com_material_code
		                              <if test="comMaterialCode != null and comMaterialCode != ''">
		                               	AND
		                              	c.com_material_code = #{comMaterialCode}
		                              </if>
		                              ORDER BY mat_inout_statement DESC  <![CDATA[ ) a
		              WHERE  ROWNUM <= #{lastIndex} )
		WHERE  rnum >= #{firstIndex}
		]]>
	</select>

	<!-- 입출고 등록 -->
	<insert id="insertMatInout"	parameterType="mes.mat.inout.service.MatInoutVO">
		INSERT INTO mat_inout (COM_MATERIAL_CODE,
								COM_MATERIAL_NAME,
								COM_MATERIAL_SIZE,
								COM_MATERIAL_UNIT,
								ERP_MATERIAL_ORDER_CODE,
								MAT_INOUT_QUANTITY,
								MAT_INOUT_UNIT_PRICE,
								MAT_INOUT_PRICE,
								MAT_LOT_NO)
		VALUES      ( # {comMaterialCode},
		              # {comMaterialName},
		              # {comMaterialSize},
		              # {comMaterialUnit},
		              # {erpMaterialOrderCode},
		              # {matInoutQuantity},
		              # {matInoutUnitPrice},
		              # {matInoutPrice},
		              # {matLotNo}) 
	</insert>

	<!-- 입출고 수정 -->
	<update id="updateSalProductInout" parameterType="mes.mat.inout.service.MatInoutVO">
		UPDATE mat_inout
		SET
		       (
		              com_material_unit = # {comMaterialUnit}),
		              mat_inout_quantity = # {matInoutQuantity},
		              mat_inout_unit_price = # {matInoutUnitPrice},
		              mat_inout_price = # {matInoutPrice}
		       )
		WHERE	mat_inout_statement = # {matInoutStatement}
	</update>
	
	<!-- 입출고 삭제 -->
	<delete id="deleteSalProductInout" parameterType="mes.mat.inout.service.MatInoutVO">
		DELETE FROM mat_inout
		WHERE mat_inout_statement = #{matInoutStatement}
	</delete>
	
</mapper>
