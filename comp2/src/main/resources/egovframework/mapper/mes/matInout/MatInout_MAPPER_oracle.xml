<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.mat.inout.service.impl.MatInoutMapper">
	
	<!-- 자재입출고조회페이지 전체조회 -->
	<select id="selectMatInoutList" parameterType="mes.mat.inout.service.MatInoutVO" resultType="egovMap">
		SELECT *
		FROM   (
		              SELECT a.*,
		                     ROWNUM rnum
		              FROM   (
		                              SELECT   c.com_material_code,
		                                       c.com_material_name,
		                                       c.com_material_size,
		                                       c.com_material_unit,
		                                       e.erp_material_order_code,
		                                       m.mat_inout_quantity,
		                                       m.mat_inout_unit_price,
		                                       m.mat_inout_price,
		                                       m.mat_lot_no <!--현재고는 계산(if) -->
		                              FROM     erp_material_order e,
		                                       com_material c,
		                                       mat_inout m
		                              WHERE    e.com_material_code = c.com_material_code
		                              AND      c.com_material_code = m.com_material_code
		                              <if test="searchKeyword != null and searchKeyword != ''">
		                              	<if test="searchCondition == 0"> AND
		                              	      mat_inout_statement = #{searchKeyword}
		                              	</if>
		                              <if test="searchCondition == 1"> AND
		                                    com_material_code LIKE '%'
		                                                || #{searchKeyword}
		                                                || '%'
		                                </if>
		                              </if>
		                              ORDER BY mat_inout_statement DESC
		                              <![CDATA[ ) a
		              WHERE  ROWNUM <= #{lastIndex} )
		WHERE  rnum > #{firstIndex}
		]]>
	</select>

	<!-- 행 카운트 -->
	<select id="selectMatInoutListTotCnt" parameterType="mes.mat.inout.service.MatInoutVO" resultType="int">
		SELECT Count(*) totcnt
		FROM   erp_material_order e,
		       com_material c,
		       mat_inout m
		WHERE  e.com_material_code = c.com_material_code
		AND    c.com_material_code = m.com_material_code
		<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == 0">AND
			    mat_inout_statement = #{searchKeyword}
			</if>
			<if test="searchCondition == 1">AND
		    	com_material_code LIKE '%'
		              || #{searchKeyword}
		              || '%'
			</if>
		</if>
	</select>
</mapper>
